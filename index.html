
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Snakenoid+</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body{margin:0;background:#000;color:#0ff;font-family:system-ui;display:flex;justify-content:center;align-items:center;height:100vh}
canvas{background:#010b22;border:6px solid #0ff;border-radius:16px;box-shadow:0 0 40px #0ff}
.menu{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.85);display:none;flex-direction:column;align-items:center;justify-content:center}
button{background:#022;border:1px solid #0ff;color:#0ff;padding:8px 16px;margin:6px;border-radius:8px;font-size:16px}
</style>
</head>
<body>
<canvas id="c" width="480" height="640"></canvas>
<div class="menu" id="menu">
 <h2>SNAKENOID+</h2>
 <button onclick="start()">START</button>
 <button onclick="toggleTheme()">THEME</button>
 <button onclick="menu.style.display='none'">CLOSE</button>
</div>
<script>
const c=document.getElementById('c'),x=c.getContext('2d');
const g=16;
let snake,dx,dy,apple,score,level,paused=false,theme=0;
let bricks=[],enemy=null,mode="ATTRACT";
let hi=localStorage.snpHi||0,ach=JSON.parse(localStorage.snpAch||'{}');
const themes=[{bg:'#010b22',snake:'#0f0'},{bg:'#22010b',snake:'#ff0'}];

function unlock(a){if(!ach[a]){ach[a]=1;localStorage.snpAch=JSON.stringify(ach);}}

function reset(){
 snake=[{x:240,y:480}];dx=g;dy=0;score=0;level=1;
 apple={x:240,y:320};build();mode="PLAY";
}

function build(){
 bricks=[];enemy=null;
 for(let r=0;r<level+2;r++)
  for(let c=0;c<10;c++)
   bricks.push({x:c*48,y:r*24+40,a:true});
 if(level%2===0) enemy={x:200,y:100,dx:4};
}

function start(){menu.style.display='none';reset();}

document.addEventListener('keydown',e=>{
 if(e.key==='Escape') menu.style.display='flex';
 if(mode!=="PLAY") return;
 if((e.key==='ArrowLeft'||e.key==='a')&&dx===0){dx=-g;dy=0}
 if((e.key==='ArrowRight'||e.key==='d')&&dx===0){dx=g;dy=0}
 if((e.key==='ArrowUp'||e.key==='w')&&dy===0){dx=0;dy=-g}
 if((e.key==='ArrowDown'||e.key==='s')&&dy===0){dx=0;dy=g}
});

function toggleTheme(){theme=(theme+1)%themes.length}

let t=0;
function loop(){
 requestAnimationFrame(loop);
 c.style.background=themes[theme].bg;
 x.clearRect(0,0,c.width,c.height);

 if(mode==="ATTRACT"){
  x.fillStyle='#0ff';x.font='28px monospace';
  x.fillText("SNAKENOID+",110,300);
  x.font='14px monospace';
  x.fillText("PRESS ESC FOR MENU",130,340);
  return;
 }

 if(++t<6) return; t=0;

 let h={x:snake[0].x+dx,y:snake[0].y+dy};
 if(h.x<0)h.x=c.width-g;if(h.y<0)h.y=c.height-g;
 if(h.x>=c.width)h.x=0;if(h.y>=c.height)h.y=0;

 for(let s of snake) if(h.x===s.x&&h.y===s.y){
  hi=Math.max(hi,score);localStorage.snpHi=hi;
  unlock("FIRST_CRASH");mode="ATTRACT";return;
 }
 snake.unshift(h);

 if(h.x===apple.x&&h.y===apple.y){
  score+=10;unlock("FIRST_APPLE");
  apple={x:Math.floor(Math.random()*30)*g,y:Math.floor(Math.random()*35)*g}
 } else snake.pop();

 bricks.forEach(b=>{
  if(b.a&&h.x<b.x+48&&h.x+g>b.x&&h.y<b.y+24&&h.y+g>b.y){
   b.a=false;score+=25;
  }
 });

 if(enemy){
  enemy.x+=enemy.dx;
  if(enemy.x<0||enemy.x>320) enemy.dx*=-1;
 }

 if(bricks.every(b=>!b.a)){level++;unlock("LEVEL_"+level);build()}

 bricks.forEach(b=>{if(b.a){x.fillStyle='#39f';x.fillRect(b.x,b.y,46,22)}});
 if(enemy){x.fillStyle='orange';x.fillRect(enemy.x,enemy.y,40,40)}
 x.fillStyle='red';x.beginPath();x.arc(apple.x+8,apple.y+8,8,0,6.28);x.fill();
 x.fillStyle=themes[theme].snake;snake.forEach(s=>x.fillRect(s.x,s.y,g-1,g-1));
 x.fillStyle='#0ff';x.fillText(`LV ${level} SCORE ${score} HI ${hi}`,10,630);
}
loop();
</script>
</body>
</html>
